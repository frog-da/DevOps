# 1.3

## Kube Prometheus Stack Components

A collection of tools called the Kube Prometheus Stack combine to offer an all-inclusive monitoring solution for Kubernetes clusters. An description of its parts and their functions may be found below.

### Prometheus

At the center of the monitoring stack, Prometheus is in charge of gathering and storing metrics data. Periodically, it collects metrics from configured endpoints using scraping and saves the information in a time-series database. Additionally, it assesses alerting rules and sets off alarms in accordance with these guidelines.

### Alertmanager

Alertmanager is tasked with handling alerts sent by Prometheus. It can group, deduplicate, and route alerts to different notification channels such as email or messaging platforms like Slack. It also takes care of silencing and inhibition of alerts.

### Grafana

With Grafana, you can create, examine, and distribute dashboards that show metrics data that has been requested from Prometheus in a graphical style. It is essential for both in-depth analysis and monitoring the cluster's operational health.

### Node Exporter

A Prometheus exporter called Node Exporter gathers a multitude of metrics pertaining to the operating system and hardware from each node in a Kubernetes cluster. It offers information on how well the CPU, memory, disk, and network are being used by the system.

### kube-state-metrics

The kube-state-metrics service is designed to listen to the Kubernetes API server and produce metrics regarding the status of different cluster objects, including nodes and deployments. Understanding workload performance and resource usage requires knowledge of this data.

### Prometheus Operator

Prometheus and associated monitoring components are deployed and managed using Kubernetes natively by the Prometheus Operator. It facilitates simple configuration and automation of resource monitoring through the use of Custom Resource Definitions (CRDs).

### ServiceMonitor

The Prometheus Operator introduces the Custom Resource Definition known as ServiceMonitor. It specifies a structure, including endpoints, port numbers, and intervals for metrics scraping, for how Prometheus should monitor services.

### Additional Components

A few more optional parts can be added, such as the Prometheus Adapter, which increases the stack's capability by offering a unique metrics API for autoscaling in response to Prometheus measurements.

# 1.4

```bash
kubectl get po,sts,svc,pvc,cm
NAME                                                         READY   STATUS             RESTARTS        AGE
pod/alertmanager-monitoring-kube-prometheus-alertmanager-0   2/2     Running            0               2m15s
pod/app-go-0                                                 0/1     CrashLoopBackOff   156 (83s ago)   3d17h
pod/app-python-0                                             2/2     Running            0               33m
pod/app-python-1                                             2/2     Running            0               33m
pod/app-python-2                                             2/2     Running            0               33m
pod/monitoring-grafana-6f8d546676-qfjrk                      3/3     Running            0               2m16s
pod/monitoring-kube-prometheus-operator-5fbb66b4b-88c5x      1/1     Running            0               2m16s
pod/monitoring-kube-state-metrics-74f4d8858f-m2jc7           1/1     Running            0               2m16s
pod/monitoring-prometheus-node-exporter-zfvkx                1/1     Running            0               2m16s
pod/prometheus-monitoring-kube-prometheus-prometheus-0       2/2     Running            0               2m14s
pod/vault-0                                                  1/1     Running            3 (2d5h ago)    20d
pod/vault-agent-injector-5cd8b87c6c-mbjcf                    1/1     Running            3 (2d5h ago)    20d

NAME                                                                    READY   AGE
statefulset.apps/alertmanager-monitoring-kube-prometheus-alertmanager   1/1     2m15s
statefulset.apps/app-go                                                 0/3     3d17h
statefulset.apps/app-python                                             3/3     33m
statefulset.apps/prometheus-monitoring-kube-prometheus-prometheus       1/1     2m14s
statefulset.apps/vault                                                  1/1     20d

NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   2m15s
service/app-go                                    LoadBalancer   10.105.31.63     <pending>     8080:31821/TCP               27d
service/app-python                                LoadBalancer   10.99.196.244    <pending>     80:32468/TCP                 33m
service/kubernetes                                ClusterIP      10.96.0.1        <none>        443/TCP                      34d
service/monitoring-grafana                        NodePort       10.109.70.75     <none>        80:31908/TCP                 2m16s
service/monitoring-kube-prometheus-alertmanager   ClusterIP      10.97.107.75     <none>        9093/TCP,8080/TCP            2m16s
service/monitoring-kube-prometheus-operator       ClusterIP      10.107.174.139   <none>        443/TCP                      2m16s
service/monitoring-kube-prometheus-prometheus     ClusterIP      10.106.106.195   <none>        9090/TCP,8080/TCP            2m16s
service/monitoring-kube-state-metrics             ClusterIP      10.109.100.130   <none>        8080/TCP                     2m16s
service/monitoring-prometheus-node-exporter       ClusterIP      10.109.137.168   <none>        9100/TCP                     2m16s
service/prometheus-operated                       ClusterIP      None             <none>        9090/TCP                     2m14s
service/vault                                     ClusterIP      10.109.162.236   <none>        8200/TCP,8201/TCP            20d
service/vault-agent-injector-svc                  ClusterIP      10.109.78.200    <none>        443/TCP                      20d
service/vault-internal                            ClusterIP      None             <none>        8200/TCP,8201/TCP            20d

NAME                                                                     DATA   AGE
configmap/config                                                         1      33m
configmap/kube-root-ca.crt                                               1      34d
configmap/monitoring-grafana                                             1      2m16s
configmap/monitoring-grafana-config-dashboards                           1      2m16s
configmap/monitoring-kube-prometheus-alertmanager-overview               1      2m16s
configmap/monitoring-kube-prometheus-apiserver                           1      2m16s
configmap/monitoring-kube-prometheus-cluster-total                       1      2m16s
configmap/monitoring-kube-prometheus-controller-manager                  1      2m16s
configmap/monitoring-kube-prometheus-etcd                                1      2m16s
configmap/monitoring-kube-prometheus-grafana-datasource                  1      2m16s
configmap/monitoring-kube-prometheus-grafana-overview                    1      2m16s
configmap/monitoring-kube-prometheus-k8s-coredns                         1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-cluster               1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-multicluster          1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-namespace             1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-node                  1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-pod                   1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-workload              1      2m16s
configmap/monitoring-kube-prometheus-k8s-resources-workloads-namespace   1      2m16s
configmap/monitoring-kube-prometheus-kubelet                             1      2m16s
configmap/monitoring-kube-prometheus-namespace-by-pod                    1      2m16s
configmap/monitoring-kube-prometheus-namespace-by-workload               1      2m16s
configmap/monitoring-kube-prometheus-node-cluster-rsrc-use               1      2m16s
configmap/monitoring-kube-prometheus-node-rsrc-use                       1      2m16s
configmap/monitoring-kube-prometheus-nodes                               1      2m16s
configmap/monitoring-kube-prometheus-nodes-darwin                        1      2m16s
configmap/monitoring-kube-prometheus-persistentvolumesusage              1      2m16s
configmap/monitoring-kube-prometheus-pod-total                           1      2m16s
configmap/monitoring-kube-prometheus-prometheus                          1      2m16s
configmap/monitoring-kube-prometheus-proxy                               1      2m16s
configmap/monitoring-kube-prometheus-scheduler                           1      2m16s
configmap/monitoring-kube-prometheus-workload-total                      1      2m16s
configmap/prometheus-monitoring-kube-prometheus-prometheus-rulefiles-0   34     2m14s
```

1. Pods (po): Pods are the smallest deployable units of computing that can be created and managed in Kubernetes.
   - `pod/alertmanager-prometheus-kube...`. is a pod belonging to the Prometheus Alertmanager, which is used for alerting.
   - `pod/app-go-0` is a pod for an Go application, currently not ready.
   - `pod/app-python-0`, `pod/app-python-1`, and `pod/app-python-2` are pods for a Python application, all ready and running.
   - `pod/prometheus-grafana-...` is a pod running Grafana for dashboards, ready and running.
   - `pod/prometheus-kube-prometheus-operator-...` is a pod for the Prometheus Operator, managing Prometheus and Alertmanager deployments.
   - `pod/prometheus-prometheus-node-exporter-...`. is a pod for the Prometheus Node Exporter, which collects hardware and OS metrics.
2. StatefulSets (sts): StatefulSets manage the deployment and scaling of a set of Pods and provide guarantees about the ordering and uniqueness of these Pods.
   - statefulset.apps/alertmanager-prometheus-kube... manages the Alertmanager pod instances.
   - `statefulset.apps/app-go` manages Go app pods, currently none ready.
   - `statefulset.apps/app-python` manages Python app pods, all ready.
   - `statefulset.apps/prometheus-prometheus-kube...` manages Prometheus pods.
   - `statefulset.apps/vault manages` pods for Vault, a tool for secrets management.
3. Services (svc): Services are an abstraction that defines a logical set of Pods and a policy by which to access them.

   - Services like service/alertmanager-operated and service/prometheus-operated expose certain ports for communication but have no external IP.
   - LoadBalancer services like service/app-go and service/app-python are meant to expose the service externally, but the external IP is pending.
   - ClusterIP services like service/kubernetes expose services within the cluster.

4. PersistentVolumeClaims (pvc): PersistentVolumeClaims are a request for storage by a user. There are none listed in your output, suggesting that you don't have any PVCs or none are in the selected namespaces.

5. ConfigMaps (cm): ConfigMaps hold configuration data for pods to consume.
   The ConfigMaps listed, such as configmap/prometheus-kube-prometheus-alertmanager-overview, contain configuration which can be used by applications or system components.

# 1.5
a.
kube_statefulset_created
![image](https://github.com/frog-da/DevOps/assets/84839431/bd8668d7-14d1-4de6-a8b4-1213fe1a5f55)

b.
namespace_cpu:kube_pod_container_resource_limits:sum
![image](https://github.com/frog-da/DevOps/assets/84839431/e3adeac7-2bb8-4286-a81a-3839a7b3afca)

c.
:node_memory_MemAvailable_bytes:sum{}
![image](https://github.com/frog-da/DevOps/assets/84839431/af43cfe6-1fb8-4094-b7b4-4153cbb303f4)

d.
kubelet_active_pods
![image](https://github.com/frog-da/DevOps/assets/84839431/c039ef99-2c20-4aa9-af40-c0a7fdb5a6a5)

kubelet_running_containers
![image](https://github.com/frog-da/DevOps/assets/84839431/bdb236f2-26fc-424e-b64c-e180f3eee5ce)

e.
node_network_speed_bytes
![image](https://github.com/frog-da/DevOps/assets/84839431/dfb9e0b5-7a0f-48b3-ae2a-3905f01efc4d)

f.
node_network_speed_bytes
![image](https://github.com/frog-da/DevOps/assets/84839431/582a5884-0090-4a9b-ba2c-5d2abcc2077f)

# 2.2


```bash
kubectl exec pod/app-python-2 -- cat /init/index.html
Defaulted container "app-python" out of: app-python, vault-agent, install (init), vault-agent-init (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```


# Bonus


## 1.
![image](https://github.com/frog-da/DevOps/assets/84839431/7904897a-017f-4147-a82b-d31cf16a7148)

![image](https://github.com/frog-da/DevOps/assets/84839431/cdb75bdd-46cf-4343-9cd2-2bb1f5ea45b8)

## 2.


```bash
kubectl exec pod/app-python-2 -- cat /init/index.html
Defaulted container "app-python" out of: app-python, vault-agent, install-1 (init), install-2 (init), install-3 (init), vault-agent-init (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
hello from the second container
hello from the third container
```
